# Genesis求解器接口文档

本文件夹包含Genesis引擎中各个求解器的详细文档，涵盖了`genesis/engine/solvers/__init__.py`中对外导出的所有求解器接口。

## 文档列表

### 1. [ToolSolver](tool_solver.md) - 工具求解器
- **功能**: 临时解决方案，用于刚体到柔体的单向可微耦合
- **特点**: 简单的实体管理、边界条件、梯度支持
- **涉及的类**: `ToolSolver`
- **行数**: 174行

### 2. [RigidSolver](rigid_solver.md) - 刚体求解器
- **功能**: 铰接刚体系统动力学模拟
- **特点**: 约束求解、碰撞检测、接触岛、休眠机制
- **涉及的类**: `RigidSolver`, `StaticRigidSimConfig`
- **应用**: 机器人仿真、机械臂、腿足机器人
- **行数**: 461行

### 3. [AvatarSolver](avatar_solver.md) - 角色求解器
- **功能**: 纯运动学角色动画
- **特点**: 继承RigidSolver但不考虑物理、无约束求解
- **涉及的类**: `AvatarSolver` (继承自 `RigidSolver`)
- **应用**: 角色动画、运动学控制
- **行数**: 148行

### 4. [MPMSolver](mpm_solver.md) - 物质点法求解器
- **功能**: 连续体材料模拟（弹性体、塑性体、液体、雪等）
- **特点**: 粒子-网格混合方法、SVD分解、可微分
- **涉及的类**: `MPMSolver`
- **辅助函数**: `signmax()`, `backward_svd()`
- **应用**: 软体、液体、雪、沙土
- **行数**: 314行

### 5. [SPHSolver](sph_solver.md) - 光滑粒子流体动力学求解器
- **功能**: 液体模拟
- **特点**: WCSPH和DFSPH两种压力求解方法、空间哈希
- **涉及的类**: `SPHSolver`
- **应用**: 水、液体模拟
- **行数**: 404行

### 6. [FEMSolver](fem_solver.md) - 有限元法求解器
- **功能**: 可变形固体模拟（四面体网格）
- **特点**: 显式和隐式时间积分、牛顿法+PCG+线搜索、可微分
- **涉及的类**: `FEMSolver`
- **应用**: 软体、肌肉、变形物体
- **行数**: 398行

### 7. [SFSolver](sf_solver.md) - 稳定流体求解器
- **功能**: 欧拉网格气体模拟
- **特点**: Jos Stam稳定流体方法、半拉格朗日平流、压力投影
- **涉及的类**: `SFSolver`, `TexPair`
- **应用**: 烟雾、气体扩散、流体艺术效果
- **行数**: 316行

### 8. [PBDSolver](pbd_solver.md) - 基于位置动力学求解器
- **功能**: 布料、弹性体、液体、粒子模拟
- **特点**: 无条件稳定、约束投影、XPBD、多材料
- **涉及的类**: `PBDSolver`, `MATERIAL`枚举
- **应用**: 布料、软体、液体、粒子效果
- **行数**: 440行

## 文档结构

每个求解器文档都按照统一的结构组织：

### 1. 概述
- 求解器的主要功能和用途
- 涉及的类和辅助函数

### 2. 功能模块划分
将求解器的功能划分为若干相对独立的模块，每个模块包含：
- **模块功能说明**
- **涉及的函数列表**
- **每个函数的详细说明**：
  - 功能描述
  - 参数说明
  - 返回值
  - 操作流程或算法

### 3. 主要功能管线
定义复杂功能的实现管线，通常包括：
- **时间步进管线**: 模拟的主循环流程
- **反向传播管线**: 梯度计算流程（如果支持可微分）
- **特定算法管线**: 如约束求解、压力求解等

### 4. 设计特点
总结求解器的设计亮点和技术特色

## 求解器对比

| 求解器 | 类型 | 可微分 | 主要应用 | 特点 |
|--------|------|--------|----------|------|
| ToolSolver | 刚体 | 部分 | 刚软耦合 | 临时方案 |
| RigidSolver | 刚体 | 否 | 机器人 | 约束求解、接触岛 |
| AvatarSolver | 刚体 | 否 | 角色动画 | 纯运动学 |
| MPMSolver | 连续体 | 是 | 软体/液体 | 粒子-网格混合 |
| SPHSolver | 流体 | 否 | 液体 | WCSPH/DFSPH |
| FEMSolver | 固体 | 是 | 可变形固体 | 隐式/显式积分 |
| SFSolver | 气体 | 否 | 烟雾 | 欧拉网格 |
| PBDSolver | 多用途 | 否 | 布料/软体/液体 | 无条件稳定 |

## 技术术语表

### 时间积分
- **显式积分**: 直接从当前状态计算下一状态，速度快但有稳定性限制
- **隐式积分**: 求解非线性方程组，稳定但计算量大
- **半隐式**: 介于两者之间的折中方案

### 求解器
- **PCG (Preconditioned Conjugate Gradient)**: 预条件共轭梯度法
- **牛顿法**: 求解非线性方程的迭代方法
- **Jacobi迭代**: 简单的线性系统求解器
- **Gauss-Seidel**: 另一种线性系统求解器

### 约束
- **等式约束**: 必须严格满足的约束（如焊接）
- **不等式约束**: 单向约束（如接触、关节限制）
- **XPBD**: 扩展PBD，使用柔度参数

### 核函数
- **Poly6核**: 用于密度计算的SPH核函数
- **Spiky核**: 用于压力计算的SPH核函数
- **Cubic spline**: 三次样条核函数

### 其他
- **SVD (Singular Value Decomposition)**: 奇异值分解
- **RNEA**: 递归牛顿-欧拉算法
- **CRB**: 复合刚体算法
- **接触岛**: 将刚体分组为独立接触岛
- **休眠**: 静止物体进入休眠状态以节省计算

## 使用建议

1. **选择合适的求解器**:
   - 刚体机器人 → RigidSolver
   - 角色动画 → AvatarSolver
   - 软体、液体 → MPMSolver
   - 水模拟 → SPHSolver
   - 精确固体 → FEMSolver
   - 烟雾气体 → SFSolver
   - 布料、快速软体 → PBDSolver

2. **可微分需求**:
   - 需要梯度 → MPMSolver或FEMSolver
   - 不需要梯度 → 其他求解器

3. **性能考虑**:
   - 实时模拟 → PBDSolver, SFSolver
   - 高精度 → FEMSolver (隐式), MPMSolver
   - 大规模 → RigidSolver (接触岛+休眠)

## 文档统计

- **总文档数**: 8个
- **总行数**: 2655行
- **涉及的求解器类**: 8个
- **辅助类/函数**: 多个（TexPair, MATERIAL枚举, backward_svd等）

## 贡献

本文档是对Genesis引擎求解器代码的分析和总结。如有疑问或需要更新，请参考源代码：
- 源代码路径: `genesis/engine/solvers/`
- 接口导出: `genesis/engine/solvers/__init__.py`

## 版本信息

- 文档创建日期: 2024年10月
- 基于代码版本: Genesis最新版本
